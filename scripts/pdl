#!/usr/bin/env bash
# Natural-ish wrapper: `./scripts/pdl js 01` or `./scripts/pdl js`

set -euo pipefail

if [[ $# -lt 1 ]]; then
  echo "Usage: $0 <js|py|php> [fixture_key]" >&2
  exit 1
fi

LANG="$1"; shift
KEY="${1-}"

ROOT="$(cd "$(dirname "$0")/.." && pwd)"

case "$LANG" in
  js)
    node "$ROOT/tests/js/run.js" ${KEY:+$KEY}
    ;;
  py)
    python3 "$ROOT/tests/py/run_render.py" ${KEY:+$KEY}
    ;;
  php)
    if command -v php >/dev/null 2>&1; then
      php "$ROOT/tests/php/run_render.php" ${KEY:+$KEY}
    else
      echo "php binary not found; skipping" >&2
    fi
    ;;
  *)
    echo "Unknown target: $LANG (use js|py|php)" >&2
    exit 1
    ;;
esac
